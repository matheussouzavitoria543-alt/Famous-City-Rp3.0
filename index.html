<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Progresso em Foco</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/feather-icons"></script>
<style>
:root{
  --site-bg: #ffffff;
  --primary: #3B82F6;
  --bar-color: #3B82F6;
  --button-color: #3B82F6;
}
body{background-color:var(--site-bg); transition:background-color .3s ease, background-image .3s ease;}
.progress-bar{transition:width .45s ease-in-out;}
.global-modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.45);z-index:60}
.card{background:white;border-radius:.75rem;box-shadow:0 6px 24px rgba(0,0,0,.08);}
.hidden{display:none;}
.badge{font-size:.75rem;padding:.125rem .5rem;border-radius:.5rem;background:rgba(0,0,0,.06)}
</style>
</head>
<body class="min-h-screen">

<!-- ... seu HTML continua igual até o final ... -->

<script>
feather.replace();

const LS_KEYS = {
  BARS: 'pef_bars_v1',
  SITE_COLOR: 'pef_site_color',
  BAR_COLOR: 'pef_bar_color',
  BUTTON_COLOR: 'pef_button_color',
  MEMBER_NAME: 'pef_member_name',
  CREDENTIALS: 'pef_creds'
};

let bars = JSON.parse(localStorage.getItem(LS_KEYS.BARS) || '[]');
let credentials = JSON.parse(localStorage.getItem(LS_KEYS.CREDENTIALS) || '[]');
let onlineMembers = new Set();

function saveBars(){ localStorage.setItem(LS_KEYS.BARS, JSON.stringify(bars)); }
function saveCredentials(){ localStorage.setItem(LS_KEYS.CREDENTIALS, JSON.stringify(credentials)); }

function initTheme(){
  const site = localStorage.getItem(LS_KEYS.SITE_COLOR);
  const barc = localStorage.getItem(LS_KEYS.BAR_COLOR);
  const btnc = localStorage.getItem(LS_KEYS.BUTTON_COLOR);
  if(site) document.documentElement.style.setProperty('--site-bg', site);
  if(barc) document.documentElement.style.setProperty('--bar-color', barc);
  if(btnc) document.documentElement.style.setProperty('--button-color', btnc);
}
initTheme();

function showToast(msg, time=2000){
  const t = document.getElementById('toast');
  const c = document.getElementById('toastContent');
  c.textContent = msg;
  t.classList.remove('hidden');
  setTimeout(()=> t.classList.add('hidden'), time);
}

function openSettingsPanel(){
  document.getElementById('inputMemberName').value = localStorage.getItem(LS_KEYS.MEMBER_NAME) || '';
  document.getElementById('memberSiteColor').value = localStorage.getItem(LS_KEYS.SITE_COLOR) || '#ffffff';
  document.getElementById('memberBarColor').value = localStorage.getItem(LS_KEYS.BAR_COLOR) || '#3B82F6';
  document.getElementById('settingsPanel').classList.remove('hidden');
}
function closeSettingsPanel(){ document.getElementById('settingsPanel').classList.add('hidden'); }

function updateMemberName(){
  const v = document.getElementById('inputMemberName').value.trim();
  if(v) { localStorage.setItem(LS_KEYS.MEMBER_NAME, v); showToast('Nome salvo'); }
}

function memberChangeSiteColor(val){
  document.documentElement.style.setProperty('--site-bg', val);
  localStorage.setItem(LS_KEYS.SITE_COLOR, val);
}
function memberChangeBarColor(val){
  document.documentElement.style.setProperty('--bar-color', val);
  localStorage.setItem(LS_KEYS.BAR_COLOR, val);
  renderBars();
}
function memberSetBackground(file){
  if(!file) return;
  const r = new FileReader();
  r.onload = e => { document.body.style.backgroundImage = `url(${e.target.result})`; showToast('Fundo atualizado'); };
  r.readAsDataURL(file);
}

/* ====== Admin login & panel (valida credenciais geradas) ====== */
const ADMIN = {user:'admin', pass:'123456'};
function adminLogin(){
  const u = document.getElementById('adminUserInput').value.trim();
  const p = document.getElementById('adminPassInput').value.trim();

  // Credenciais padrão
  if(u === ADMIN.user && p === ADMIN.pass){
    localStorage.setItem('pef_is_admin','1');
    document.getElementById('shieldIcon').classList.remove('hidden');
    document.getElementById('settingsPanel').classList.add('hidden');
    showToast('Logado como administrador');
    return;
  }

  // Credenciais geradas
  const match = credentials.find(c => c.user === u && c.pass === p);
  if(match){
    localStorage.setItem('pef_is_admin','1');
    document.getElementById('shieldIcon').classList.remove('hidden');
    document.getElementById('settingsPanel').classList.add('hidden');
    showToast('Logado como administrador via credencial gerada');
    return;
  }

  showToast('Usuário ou senha incorretos');
}

function openAdminPanel(){
  if(!localStorage.getItem('pef_is_admin')) { showToast('Necessário login de admin.'); return; }
  renderCredentials();
  renderOnlineMembers();
  document.getElementById('adminPanel').classList.remove('hidden');
}
function closeAdminPanel(){ document.getElementById('adminPanel').classList.add('hidden'); }

/* ====== O restante do seu código permanece exatamente igual ====== */

/* ====== Corrige botão de escudo ====== */
document.getElementById('shieldIcon').onclick = function() {
  if(localStorage.getItem('pef_is_admin')) {
    document.getElementById('adminPanel').classList.remove('hidden');
  } else {
    showToast('Faça login como admin em Configurações');
  }
};
</script>
</body>
</html>
